# Modeling
데이터베이스 설계할 때 업무 분석서로부터 엔티티를 도출하고, 엔티티들 간의 관계, 각 엔티티의 식별자 및 속성을 정의하는 단계를 밟게 된다. 여러 데이터베이스 설계를 다루는 책에서 모델링 예시를 들때 관계부터 정의하는 경우가 많지만, 주식별자를 먼저 정의하고 관계와 외래식별자의 정의를 나중에 하는 것이 편리하다. 

데이터 모델링을 수행하기 위해 ERD(Entity-Relationship Diagram)라는 수단을 사용하며, 이를 통해 모델링의 결과를 표현한다.


## table of contents
1. [주식별자 정의](#주식별자-정의)
1. [관계 정의](#관계-정의)
1. [외래식별자 정의](#외래식별자-정의)


---

## 주식별자 정의
주식별자(primary identifier)는 **엔티티에 소속된 인스턴스들을 구별하는 기준 역할**을 하는 속성을 말한다. 물리적 데이터베이스의 용어로 말하면, 테이블에서 **각 튜플의 유일성을 구별해줄 수 있는 컬럼을 말하며 기본키**라고 부른다. 주식별자는 중복이 없어야 하며, 이는 현재 시점에서뿐만 아니라 미래에도 중복된 값이 없어야 한다는 뜻이다. 



---


## 관계 정의
두 엔티티 사이의 관계를 정의하기 위해서는 관계의 개념을 분명히 알고 있어야 한다. 

### 엔티티의 관계를 정의하는 지침
1. 문서로부터 동사를 구분한다.
1. 관계 매트릭스를 그려본다.
1. 부모, 자식 관계에 있는 엔티티들을 찾아본다.
1. 관계가 정의되면 카디낼러티와 관계의 참여도를 표시한다. 

### 1. 문서로부터 동사를 구분
엔티티를 도출할 때 참고했던 업무 기술서, 장부나 전표, 사용자 요구사항 기술서로부터 구분한 '명사'들 가운데 관계를 찾기 위해 **동사**를 검토한다. 예를 들어 '고객에게 주문서를 발송한다'라는 문장이 있다면 고객과 주문서는 엔티티이고, 서로 관계가 있다고 여길 수 있다. 이처럼 동사의 의해 연결된 엔티티는 서로 관계가 있을 가능성이 크다. 

### 2. 관계 매트릭스를 그려보기
엔티티들을 매트릭스상의 가로, 세로에 나열하고 교차지점에 있는 두 엔티티가 서로 관계 있는지 검토한다. 예를 들어 도서의 '대출'엔티티는 특성상 누가, 어떤 도서를 빌렸는지 관리해야 하므로 '회원' 엔티티 및 '도서' 엔티티와 관련이 있다. 이처럼 관계 매트릭스를 활용한 방법은 다소 직관을 필요로 한다.

### 3. 부모, 자식 관계에 있는 엔티티들을 찾아보기
어떤 엔티티 A의 정보가 만들어지기 위해 다른 엔티티 B의 정보를 필요로 하는 관계에 있을 때, 엔티티 B는 엔티티 A와 관계를 가지며 엔티티 B는 엔티티 A의 부모 엔티티가 된다. 이 방법은 관계 매트릭스와 함께 사용하면 효과적이다. 

예를 들어 학생 엔티티와 수강 엔티티를 살펴보면 수강을 하기 위해 반드시 해당 학교의 학생임과 동시에 학생 정보가 있어야 어떤 과목을 수강하는지 저장할 수 있다. 이 경우 학생 엔티티는 수강 엔티티와 관련이 있고, 학생 엔티티는 수강 엔티티의 부모 엔티티이다. 

### 4. 관계가 정의되면 카디낼러티와 관계의 참여도를 표시
두 엔티티가 관계가 있다고 여겨지면 ERD상에 관계를 표시하고 관계의 카디낼러티와 참여도를 표시한다.


## 외래식별자 정의
외래식별자는 관계와 밀접하다. 두 엔티티가 관계가 있다면 자식 엔티티의 외래식별자 속성이 부모 엔티티의 주식별자를 참조하게 된다. 관계를 올바르게 정의했다면 외래식별자는 기계적으로 정의할 수 있다.

### 외래식별자를 정의하는 지침
1. 관계가 있는 두 엔티티를 부모, 자식으로 구분한다.
1. 부모 엔티티의 주식별자에 해당하는 속성이 자식 엔티티에도 존재하는지 확인한다.

### 1. 관계가 있는 두 엔티티를 부모, 자식으로 구분하기
두 엔티티 중 정보를 먼저 생성하여 가지고 있는 쪽이 부모 엔티티이고, 부모 엔티티의 정보를 가져다 사용하는 쪽이 자식 엔티티이다.

### 2. 부모 엔티티의 주식별자에 해당하는 속성이 자식 엔티티에도 존재하는지 확인하기
만일 부모 엔티티의 주식별자 속성이 자식 엔티티에도 공통적으로 존재한다면 자식 엔티티에 있는 공통 속성이 외래식별자가 된다. 만약 부모 엔티티의 주식별자 속성이 자식 엔티티에 존재하지 않는다면 자식 엔티티에 속성을 추가한 후 외래식별자로 지정하면 된다.

---


## 예제

### 회원과 대출의 관계
대출 엔티티에서 관리하고자 하는 정보는 '어떤 회원이 어떤 도서를 빌려갔는가?'이므로 당연히 대출 정보는 회원 정보와 관련이 있다. 또한 회원이 있어야 대출이 성립할 수 있으므로 회원이 부모 엔티티이고, 대출이 자식 엔티티이다. 그리고 카디낼러티는 회원:대출 = 1:N이다. 또한 회원 가입을 하고 아직 아직 대출하지 않은 회원이 있을 수 있으므로 대출 쪽 참여도는 '필수'이다. 그리고 회원의 주식별자를 대출 엔티티에서 공통속성으로 가지고 있으므로 자식 엔티티인 대출의 회원번호는 외래식별자이다. 

### 도서와 대출의 관계
대출 엔티티는 누가 어떤 도서를 빌렸는지 관리하기 위한 것이므로 대출과 도서는 관계가 있다. 그리고 도서가 있어야 대출할 수 있으므로 도서가 부모 엔티티이고, 대출이 자식 엔티티이다. 또한 도서 엔티티의 주식별자를 자식 엔티티인 대출에서 공유하고 있으므로 대출의 도서관리번호 속성은 외래식별자가 된다. 관계의 카디낼러티와 참여도는 회원과 대출 관계와 유사하다. 
