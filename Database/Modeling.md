# Modeling
데이터베이스 설계는 업무 분석서로부터 엔티티를 도출하고, 엔티티들 간의 관계, 각 엔티티의 식별자 및 속성을 정의하는 단계를 밟으며 진행된다.


## table of contents
1. [엔티티 도출](#엔티티-도출)
1. [주식별자 정의](#주식별자-정의)
1. [관계 정의](#관계-정의)
1. [외래식별자 정의](#외래식별자-정의)


---

## 엔티티 도출
데이터 모델링을 수행하기 위해 ERD(Entity-Relationship Diagram)라는 수단을 사용하며, 이를 통해 모델링의 결과를 표현한다. ERD는 데이터 모델링 작업에서 중요한 지위를 갖는데, ERD의 핵심은 엔티티를 도출하는 일이다.

### 엔티티란 무엇인가?
엔티티란 업무의 관심 대상이 되는 정보를 갖고 있거나, 그에 대한 정보를 관리할 필요가 있는 유형, 무형의 사물을 의미한다. 즉, 관리해야 할 정보를 가지고 있는 현실세계의 어떤 사물을 의미한다.

### 엔티티 도출 과정
1. 엔티티 후보 풀과 엔티티 리스트를 그린다.
1. 분석 대상 문서를 보고 명사를 찾아 표시한다.
1. 명사 하나하나에 대해 속성인지 엔티티인지 구분한다. 
1. 중복된 명사나 유사한 의미의 명사는 하나로 정리한다.
1. 엔티티 후보 풀에 있는 명사들을 검토한다.
1. 도출된 엔티티에 대하여 구출될 시스템에서 데이터를 관리할 필요가 있는지를 판단한다.
1. 엔티티 기술서를 작성한다.

### 도서관 관리 시스템 업무 기술서
아래 주어진 도서관 관리 시스템 업무 기술서인를 활용해 엔티티 도출을 연습하기

```
1. 도서를 대출하기 위해서는 회원 등록이 필요하다.
2. 회원 등록을 위해 사용자이름, 전화번호, 집주소, 이메일 주소를 입력한다. 
3. 회원가입을 하면 회원증이 발급되고, 회원카드에 부착된 바코드를 가지고 대출/반납 시 신분을 확인할 수 있다.
4. 회원에게는 자체 관리를 위해 회원번호가 부여된다.
5. 일반 회원의 대출 가능 도서 수는 5권으로 제한한다.
6. 회원 탈퇴를 하려면 미반납 도서가 없어야 한다.
7. 회원이 탈퇴하면 회원 정보에 탈퇴여부를 기록하고, 월말 결산시 탈퇴한 회원을 일괄 정리한다. 
8. 탈퇴한 회원이 재가입시에는 최초 가입과 동일한 절차를 거친다. 
```

#### 중요한 교훈
어떤 데이터가 관리되어야 할 정보인지 파악하는 능력 중요하다.
현실세계에는 존재하나 구축될 정보 시스템에는 존재할 필요가 없는 것도 있다. 엔티티가 데이터베이스 내에 존재해야 하는 이유는 데이터를 저장하고 관리하기 위함이다. 


---


## 주식별자 정의
주식별자(primary identifier)는 **엔티티에 소속된 인스턴스들을 구별하는 기준 역할**을 하는 속성을 말한다. 물리적 데이터베이스의 용어로 말하면, 테이블에서 **각 튜플의 유일성을 구별해줄 수 있는 컬럼을 말하며 기본키**라고 부른다. 

엔티티에서 속성은 테이블에서 컬럼이 되고, 주식별자는 기본키가 된다. 

### 주식별자 정의에서 중요한 점
주식별자는 중복이 없어야 하며, 이는 현재 시점에서뿐만 아니라 미래에도 중복된 값이 없어야 한다.

500명의 회원이 있을 때 이름을 주식별자로 가정할 경우, 500명의 회원 이름은 모두 달라야 한다. 그렇지만 사람은 동명이인이 있을 수 있고, 우연하게 현재 500명의 회원 이름이 모두 다르더라도 앞으로 동명이인인 회원이 가이할 가능성이 있으므로 이름은 미래에 주식별자가 될 수 없다. 


여러 데이터베이스 설계를 다루는 책에서 모델링 예시를 들때 관계부터 정의하는 경우가 많지만, 주식별자를 먼저 정의하고 관계와 외래식별자의 정의를 나중에 하는 것이 편리하다. 



---


## 관계 정의
두 엔티티 사이의 관계를 정의하기 위해서는 관계의 개념을 분명히 알고 있어야 한다. 
관계를 정의하는 지짐을 잘 따라서 관계를 찾는다.

### 관계란 무엇인가?
관계란 두 엔티티 사이의 관련성을 나타내는 용어이다. 실무적으로 두 엔티티 사이에 관계가 있다는 것은 **상호 공유하는 속성**이 있다는 의미이다. 


### 엔티티의 관계를 정의하는 지침
1. 문서로부터 동사를 구분한다.
1. 관계 매트릭스를 그려본다.
1. 부모, 자식 관계에 있는 엔티티들을 찾아본다.
1. 관계가 정의되면 카디낼러티와 관계의 참여도를 표시한다. 

### 1. 문서로부터 동사를 구분
엔티티를 도출할 때 참고했던 업무 기술서, 장부나 전표, 사용자 요구사항 기술서로부터 구분한 '명사'들 가운데 관계를 찾기 위해 **동사**를 검토한다. 예를 들어 '고객에게 주문서를 발송한다'라는 문장이 있다면 고객과 주문서는 엔티티이고, 서로 관계가 있다고 여길 수 있다. 이처럼 동사의 의해 연결된 엔티티는 서로 관계가 있을 가능성이 크다. 

### 2. 관계 매트릭스를 그려보기
엔티티들을 매트릭스상의 가로, 세로에 나열하고 교차지점에 있는 두 엔티티가 서로 관계 있는지 검토한다. 예를 들어 도서의 '대출'엔티티는 특성상 누가, 어떤 도서를 빌렸는지 관리해야 하므로 '회원' 엔티티 및 '도서' 엔티티와 관련이 있다. 이처럼 관계 매트릭스를 활용한 방법은 다소 직관을 필요로 한다.

### 3. 부모, 자식 관계에 있는 엔티티들을 찾아보기
어떤 엔티티 A의 정보가 만들어지기 위해 다른 엔티티 B의 정보를 필요로 하는 관계에 있을 때, 엔티티 B는 엔티티 A와 관계를 가지며 엔티티 B는 엔티티 A의 부모 엔티티가 된다. 이 방법은 관계 매트릭스와 함께 사용하면 효과적이다. 

예를 들어 학생 엔티티와 수강 엔티티를 살펴보면 수강을 하기 위해 반드시 해당 학교의 학생임과 동시에 학생 정보가 있어야 어떤 과목을 수강하는지 저장할 수 있다. 이 경우 학생 엔티티는 수강 엔티티와 관련이 있고, 학생 엔티티는 수강 엔티티의 부모 엔티티이다. 

### 4. 관계가 정의되면 카디낼러티와 관계의 참여도를 표시
두 엔티티가 관계가 있다고 여겨지면 ERD상에 관계를 표시하고 관계의 카디낼러티와 참여도를 표시한다.


## 외래식별자 정의
외래식별자는 관계와 밀접하다. 두 엔티티가 관계가 있다면 자식 엔티티의 외래식별자 속성이 부모 엔티티의 주식별자를 참조하게 된다. 관계를 올바르게 정의했다면 외래식별자는 기계적으로 정의할 수 있다.

### 외래 식별자
물리적 DB 설계 단계에서는 외래키라고 하며, 엔티티와 엔티티를 연결해주는 고리역할

### 외래식별자를 정의하는 지침
1. 관계가 있는 두 엔티티를 부모, 자식으로 구분한다.
1. 부모 엔티티의 주식별자에 해당하는 속성이 자식 엔티티에도 존재하는지 확인한다.

### 1. 관계가 있는 두 엔티티를 부모, 자식으로 구분하기
두 엔티티 중 정보를 먼저 생성하여 가지고 있는 쪽이 부모 엔티티이고, 부모 엔티티의 정보를 가져다 사용하는 쪽이 자식 엔티티이다.

### 2. 부모 엔티티의 주식별자에 해당하는 속성이 자식 엔티티에도 존재하는지 확인하기
만일 부모 엔티티의 주식별자 속성이 자식 엔티티에도 공통적으로 존재한다면 자식 엔티티에 있는 공통 속성이 외래식별자가 된다. 만약 부모 엔티티의 주식별자 속성이 자식 엔티티에 존재하지 않는다면 자식 엔티티에 속성을 추가한 후 외래식별자로 지정하면 된다.

---


## 예제

### 회원과 대출의 관계
대출 엔티티에서 관리하고자 하는 정보는 '어떤 회원이 어떤 도서를 빌려갔는가?'이므로 당연히 대출 정보는 회원 정보와 관련이 있다. 또한 회원이 있어야 대출이 성립할 수 있으므로 회원이 부모 엔티티이고, 대출이 자식 엔티티이다. 그리고 카디낼러티는 회원:대출 = 1:N이다. 또한 회원 가입을 하고 아직 아직 대출하지 않은 회원이 있을 수 있으므로 대출 쪽 참여도는 '필수'이다. 그리고 회원의 주식별자를 대출 엔티티에서 공통속성으로 가지고 있으므로 자식 엔티티인 대출의 회원번호는 외래식별자이다. 

### 도서와 대출의 관계
대출 엔티티는 누가 어떤 도서를 빌렸는지 관리하기 위한 것이므로 대출과 도서는 관계가 있다. 그리고 도서가 있어야 대출할 수 있으므로 도서가 부모 엔티티이고, 대출이 자식 엔티티이다. 또한 도서 엔티티의 주식별자를 자식 엔티티인 대출에서 공유하고 있으므로 대출의 도서관리번호 속성은 외래식별자가 된다. 관계의 카디낼러티와 참여도는 회원과 대출 관계와 유사하다. 


### 회원과 도서의 관계
회원은 대출과, 대출은 도서와 관계가 있다. 이 경우 회원과 도서는 자동적으로 간접 관계를 가지게 된다. 